## **1.0 Vision & Strategy**

- **1.1 Vision Statement:** To create a personal health dashboard which displays both basic and advanced data analysis about a user's sleep, as tracked by their Fitbit.
- **1.2 Target Persona:** Health-Conscious Harper: A user who wants to see how their lifestyle may be impacting their sleep quality. They are interested in seeing correlations generated by their Fitbit data.

## **2.0 Functional & User Experience (UX) Specifications**

- **2.1 User Stories:**
  - **Health-Conscious Harper:**
    - As Health-Conscious Harper, I want to see a simple, visual summary of my last night's sleep on the homepage so that I can quickly understand what happened during my sleep.
    - As Health-Conscious Harper, I want to see how my recent lifestyle has been impacting my sleep quality.
  - **General:**
    - As a new user, I want to sign up or log in quickly using my Google account to minimize setup friction.
    - As a new user, I want a simple, one-time process to securely connect my Fitbit account so the app can access my sleep data.
    - As a user, I want a settings page to manage my connected accounts and preferences.
    - As a user, I want the dashboard to load quickly so I can have a smooth user experience.
- **2.2 User Flows:**

  - **2.21 Onboarding Flow**

    - This flow ensures all users get to the home page regardless of authentication of authorization state.
    - There are different home page states depending on a combination of authentication and authorization.
    - The user will have the option to authenticate and/or authorize from the home page.

    ![onboarding](./assets/onboarding.jpeg)

  - **_Needed Flows:_** _Daily Check-in (Open App -> View Summary & Advice), Managing Settings._

- **2.3 UI Sketches:**
  - _This section needs visual representations for each of the app's screens. These can be low-fidelity rough sketches._
  - **_Needed Sketches:_** _Homepage, Onboarding Screens, Settings Page,_

## **3.0 System Architecture & Technology Stack**

- **3.1 High-Level Architecture:**
  - **Frontend:** A Next.js single-page application (SPA) that serves the browser client. It will also act as a reverse proxy, handling incoming HTTP requests from the browser and forwarding them to the appropriate backend services. This layer is responsible for receiving data from the backend and shaping it into the necessary format for the UI components.
  - **Backend:** A headless, frontend-agnostic API service. Its sole responsibility is to expose data and execute business logic without any knowledge of the client consuming it. This includes interacting with external services like the Fitbit API, managing all database operations, and providing the data required for various dashboard components.
- **3.2 Technology Stack:**
  - Frontend: Next.js, TypeScript, MUI, Vercel, Tanstack Query
  - Backend: Express.js, Prisma, Zod, Render
  - Database: PostgreSQL
  - Authentication: Google OAuth2.0
- **3.3 Data Models & Database Schema:**
  - See Prisma schema in the backend directory.

## **4.0 Detailed Technical Specifications**

- **4.1 API Specification (Endpoints):**
  - See Swagger documentation in the backend directory.
- **4.2 Core Business Logic:**
- **4.3 Error Handling:**
  - _This section needs to define how the system will respond to specific, predictable failures._
  - **_Example Scenario:_** _Fitbit API token expires._
  - **_System Response:_** _The backend attempts to use the refresh token to get a new access token. If successful, it will retry the original API call. If it fails, it will mark the user's Fitbit connection as invalid and queue a notification for the frontend to display a "Please reconnect your Fitbit account" message to the user._

## **5.0 Non-Functional Requirements (NFRs)**

- _This section needs to define the system's quality attributes with specific, measurable targets._
- **5.1 Security:** All user PII and health data must be encrypted at rest (e.g., AES-256). All API traffic must use HTTPS.
- **5.2 Performance:** The dashboard must load quickly.
  - **_Specific Target:_** _API p95 latency must be < 300ms. Frontend Largest Contentful Paint (LCP) must be < 2.5 seconds._
- **5.3 Data Integrity:** User sleep data must be stored securely to track progress over time.
  - **_Specific Target:_** _Implement daily backups of the production database with a 30-day retention policy._

## 6.0 MVP Checkpoints

### MVP 1: The Read-Only Wellness Dashboard

Goal: To deliver a functional, end-to-end, read-only dashboard that visualizes a demo user's sleep and wellness data. This MVP focuses on establishing a solid foundation for the data flow from the database to the UI, without the complexities of user authentication or advanced coaching features.

#### Home Dashboard

- Display of core sleep metrics (Bedtime, Wake-Up, Total Sleep, Efficiency).
- Display of daily wellness indicators (Skin Temp, Breathing Rate, HRV, SpO2).
- Visualization of sleep stages (Awake, REM, Light, Deep) in a chart.
- A date selector to navigate through the demo user's historical data, which updates all modules on the page.

#### Sleep History Page

- A tabular data grid displaying a comprehensive list of all sleep logs from the demo user.
- The table will include columns for key metrics like bedtime, wake-up time, total sleep, and sleep stages.

#### API Endpoints

- GET /users/demo: Endpoint to retrieve the hardcoded demo user.
- GET /users/:userId/sleep: Endpoint to fetch all sleep logs for the user.
- GET /users/:userId/sleep/recent: Endpoint for the most recent sleep log.
- GET /users/:userId/sleep/:date: Endpoint to get a specific sleep log by date.
- GET /users/:userId/core-metrics/:date: Endpoint for the core metrics card.
- GET /users/:userId/sleep-stages/:date: Endpoint for the sleep stages chart.
- GET /users/:userId/wellness-summary/:date: Endpoint for the wellness indicators.

#### Data Layer

- A PostgreSQL database seeded with a comprehensive set of sample data for a single demo user.

#### Features (Out of Scope for MVP 1)

- User Authentication: No Google OAuth or any other real user login system. The entire experience will be based on the demo user.
- Sleep Insights: The correlation engine driving the sleep insights feature will be pushed to MVP 2.
- Data Modification: All API endpoints will be read-only (GET). There will be no functionality to add, edit, or delete data (e.g., the "Daily Check-In" feature).
- Fitbit Integration: No live connection or data sync with the Fitbit API. All data will come from the pre-populated database.

#### Definition of Done

- A user can launch the application and land on the splash page.
- Clicking the "See a Demo" button successfully navigates the user to the home page, loading the demo user's data.
- The Home page correctly displays all core metrics, wellness indicators, and sleep stages for the most recent sleep log.
- The user can use the date selector to view data from previous days, and all components on the Home page update accordingly.
- The user can navigate to the History page and view a complete, scrollable table of the demo user's sleep data.
- The backend API is fully functional for all specified GET endpoints and returns data in the documented DTO format.
- The application is styled and responsive for a good user experience on both desktop and mobile devices.

#### Scheduled Completion Date

- September 30, 2025
